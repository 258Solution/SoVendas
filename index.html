<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulação Vendoo JS</title>
<style>
  body { font-family: Arial; background:#f5f5f7; padding:20px; }
  .card { background:#fff; border-radius:10px; padding:20px; max-width:800px; margin:10px auto; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  input, button, select { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ddd; box-sizing:border-box; }
  button { background:#111; color:#fff; cursor:pointer; }
  nav { display:flex; gap:8px; justify-content:center; margin-bottom:12px; }
  nav button { width:auto; padding:8px 12px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #eee; padding:8px; text-align:left; }
  .small { font-size:0.9rem; color:#555; }
</style>
</head>
<body>

<div class="card" id="authCard">
  <h2>Vendoo JS — Plataforma Simulada</h2>
  <div id="criarIDCard">
    <h3>Criar ID</h3>
    <input id="novoID" placeholder="Crie um ID (ex: meuNegocio01)" />
    <button id="btnCriarID">Registrar ID</button>
  </div>
  <hr>
  <div id="entrarCard">
    <h3>Entrar com ID</h3>
    <input id="loginID" placeholder="Digite seu ID" />
    <button id="btnEntrar">Entrar</button>
  </div>
</div>

<div class="card" id="userArea" style="display:none;">
  <p class="small">Logado como <b id="userIdDisplay"></b></p>
  <nav>
    <button data-page="dashboard">Dashboard</button>
    <button data-page="produtos">Produtos</button>
    <button data-page="criarProduto">Criar Produto</button>
    <button data-page="checkout">Checkout</button>
    <button id="btnSair">Sair</button>
  </nav>
</div>

<div class="card page" id="dashboardPage" style="display:none;">
  <h3>Dashboard</h3>
  <p><b>Faturamento:</b> <span id="fat">0</span></p>
  <p><b>Vendas realizadas:</b> <span id="vendasCount">0</span></p>
  <p><b>Ticket médio:</b> <span id="ticketMedio">0</span></p>
  <p><b>Taxa de conversão:</b> <span id="conversao">0%</span></p>
</div>

<div class="card page" id="produtosPage" style="display:none;">
  <h3>Produtos</h3>
  <button id="btnCriarProdutoNav">+ Criar Produto</button>
  <table>
    <thead><tr><th>Nome</th><th>Preço</th><th>Ações</th></tr></thead>
    <tbody id="prodList"></tbody>
  </table>
</div>

<div class="card page" id="criarProdutoPage" style="display:none;">
  <h3>Novo Produto</h3>
  <input id="prodNome" placeholder="Nome do produto" />
  <input id="prodPreco" placeholder="Preço (número)" type="number" />
  <button id="btnSalvarProd">Salvar produto</button>
</div>

<div class="card page" id="checkoutPage" style="display:none;">
  <h3>Checkout</h3>
  <p class="small">Insira o valor da venda e clique Enviar</p>
  <input id="checkoutValor" type="number" placeholder="Valor da venda" />
  <button id="btnEnviarVenda">Enviar</button>
  <p id="checkoutMsg" class="small"></p>
</div>

<script>
  // ------------------ UTILITÁRIOS ------------------
  let users = JSON.parse(localStorage.getItem('vendoo_users')||'{}');
  let currentUserId = null;

  const saveUsers = () => localStorage.setItem('vendoo_users', JSON.stringify(users));

  const showPage = (id) => {
    document.querySelectorAll('.page').forEach(p=>p.style.display='none');
    document.getElementById(id+'Page').style.display='block';
  };

  const atualizarDashboard = () => {
    if(!currentUserId) return;
    const user = users[currentUserId];
    const vendas = user.sales || [];
    const fat = vendas.reduce((s,v)=>s+v,0);
    const count = vendas.length;
    const ticket = count ? (fat/count).toFixed(2) : '0.00';
    const conversao = user.visits ? ((count/user.visits)*100).toFixed(2) : 0;
    document.getElementById('fat').innerText = fat.toFixed(2);
    document.getElementById('vendasCount').innerText = count;
    document.getElementById('ticketMedio').innerText = ticket;
    document.getElementById('conversao').innerText = conversao+'%';
  };

  const atualizarProdutosUI = () => {
    if(!currentUserId) return;
    const tbody = document.getElementById('prodList');
    tbody.innerHTML='';
    const selectCheckout = document.getElementById('checkoutProduto');
    if(selectCheckout) selectCheckout.innerHTML='';
    const prods = users[currentUserId].products || [];
    prods.forEach((p,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${p.name}</td><td>${p.price}</td><td><button onclick="excluirProd(${i})">Excluir</button></td>`;
      tbody.appendChild(tr);
    });
  };

  const excluirProd = (index)=>{
    users[currentUserId].products.splice(index,1);
    saveUsers();
    atualizarProdutosUI();
  };

  // ------------------ AUTENTICAÇÃO ------------------
  document.getElementById('btnCriarID').onclick = ()=>{
    const id = document.getElementById('novoID').value.trim();
    if(!id) return alert('Digite um ID');
    if(users[id]) return alert('ID já existe');
    users[id]={products:[], sales:[], visits:0};
    saveUsers();
    alert('ID criado! Agora entre com ele.');
    document.getElementById('novoID').value='';
  };

  document.getElementById('btnEntrar').onclick = ()=>{
    const id = document.getElementById('loginID').value.trim();
    if(!id || !users[id]) return alert('ID não encontrado');
    currentUserId = id;
    document.getElementById('authCard').style.display='none';
    document.getElementById('userArea').style.display='block';
    document.getElementById('userIdDisplay').innerText = id;
    showPage('dashboard');
    atualizarDashboard();
    atualizarProdutosUI();
  };

  document.getElementById('btnSair').onclick = ()=>{
    currentUserId=null;
    document.getElementById('authCard').style.display='block';
    document.getElementById('userArea').style.display='none';
  };

  // ------------------ NAV ------------------
  document.querySelectorAll('nav button[data-page]').forEach(btn=>{
    btn.onclick=()=>{
      const page=btn.dataset.page;
      showPage(page);
      if(page==='produtos'){
        users[currentUserId].visits = (users[currentUserId].visits||0)+1;
        saveUsers();
        atualizarDashboard();
      }
    };
  });

  // ------------------ PRODUTOS ------------------
  document.getElementById('btnCriarProdutoNav').onclick = ()=>showPage('criarProduto');
  document.getElementById('btnSalvarProd').onclick = ()=>{
    const nome = document.getElementById('prodNome').value.trim();
    const preco = Number(document.getElementById('prodPreco').value);
    if(!nome || !preco) return alert('Preencha nome e preço');
    users[currentUserId].products.push({name:nome, price:preco});
    saveUsers();
    document.getElementById('prodNome').value='';
    document.getElementById('prodPreco').value='';
    showPage('produtos');
    atualizarProdutosUI();
  };

  // ------------------ CHECKOUT ------------------
  document.getElementById('btnEnviarVenda').onclick = ()=>{
    const valor = Number(document.getElementById('checkoutValor').value);
    if(!valor) return alert('Digite valor da venda');
    if(!users[currentUserId].sales) users[currentUserId].sales=[];
    users[currentUserId].sales.push(valor);
    saveUsers();
    document.getElementById('checkoutValor').value='';
    document.getElementById('checkoutMsg').innerText='Venda registrada com sucesso!';
    atualizarDashboard();
  };

</script>

</body>
</html>
